# TCP/IP的分层管理
ICP/IP协议族按层次分别分为以下4层：
> 应用层、传输层、网络层和数据链路层

### 应用层
应用层决定了向用户提供应用服务时通信的活动。
TCP/IP协议族内预存了各类通用的应用服务。比如：FTP和DNS
HTTP协议也处于该层。

### 传输层
传输层对上层应用层，提供处于网络连接中的两台计算机之间的数据传输。
在传输层有两个性质不同的协议：TCP和UDP

### 网络层
网络层用来处理在网络上流动的数据包

### 链路层
用来处理连接网络的硬件部分

# IP
按层次分，IP(Internet Protocol)网际协议位于网络层。
IP协议的作用是把各种数据包传送给对方。而要保证确实传送到对方那里，则需要满足各类条件。其中两个重要的条件是IP地址和MAC地址。
IP地址可变，但MAC地址基本上不会更改。

# TCP
按层次分，TCP位于传输层，提供可靠的字节流服务。
## 三次握手建立连接
为了准确无误地将数据送达目标处，TCP协议采用了三次握手策略。
握手过程中使用了TCP的标志---SYN和ACK

1. 发送一个带SYN标志的数据包给对方
2. 接收端收到后，回传一个带有SYN/ACK标志的数据包以示传达确认信息
3. 发送的再回传一个ACK标志的数据包，代表“握手”结束

如果在握手过程中某个阶段莫名中断，TCP协议会再次以相同的顺序发送相同的数据包。

[**为什么TCP建立连接需要三次握手？**](https://www.zhihu.com/question/24853633)     
>防止服务器端因为接收了`早已失效的连接请求`报文从而一直等待客户端请求，从而浪费资源    

1. 已失效的连接请求报文段”的产生在这样一种情况下：Client发出的第一个连接请求报文段并没有丢失，而是在某个网络结点长时间的滞留了，以致延误到连接释放以后的某个时间才到达server。
2. 这是一个早已失效的报文段。但Server收到此失效的连接请求报文段后，就误认为是Client再次发出的一个新的连接请求。
3. 于是就向Client发出确认报文段，同意建立连接。
4. 假设不采用“三次握手”：只要Server发出确认，新的连接就建立了。
5. 由于现在Client并没有发出建立连接的请求，因此不会向Server发送数据。
6. 但Server却以为新的运输连接已经建立，并一直等待Client发来数据。>- 这样，Server的资源就白白浪费掉了。

## 四次挥手释放连接
TCP释放连接需要四次挥手过程，现在假设A主动释放连接：（数据传输结束后，通信的双方都可释放连接）    
- 第一次挥手：A发送释放信息到B；（发出去之后，A->B发送数据这条路径就断了）   
- 第二次挥手：B收到A的释放信息之后，回复确认释放的信息：我同意你的释放连接请求
- 第三次挥手：B发送“请求释放连接“信息给A  
- 第四次挥手：A收到B发送的信息后向B发送确认释放信息：我同意你的释放连接请求

**为什么TCP释放连接需要四次挥手？**    
>为了保证双方都能通知对方“需要释放连接”，即在释放连接后都无法接收或发送消息给对方  

在这里需要再强调几个点：  
- TCP是全双工模式，这意味着是双向都可以发送、接收的  
- 释放连接的定义是：双方都无法接收或发送消息给对方，是双向的   

所以四次挥手的理解是这样的：    
1. 当主机1发出“释放连接请求”（FIN报文段）时，只是表示主机1已经没有数据要发送 / 数据已经全部发送完毕；**但是，这个时候主机1还是可以接受来自主机2的数据。**
2. 当主机2返回“确认释放连接”信息（ACK报文段）时，表示它已经知道主机1没有数据发送了；**但此时主机2还是可以发送数据给主机1**
3. 当主机2也发送了FIN报文段时，即告诉主机1我也没有数据要发送了；**此时，主机1和2已经无法进行通信：主机1无法发送数据给主机2，主机2也无法发送数据给主机1，此时，TCP的连接才算释放**

[关于TCP/IP，必知必会的十个问题](http://mp.weixin.qq.com/s/ZApSshJ9wVN3Zunwc2oMdg)

# DNS
DNS服务是和HTTP协议一样位于应用层的协议。它提供域名到IP地址之间的解析服务。
